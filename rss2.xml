<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>睡月花儿</title>
    <link>https://www.gagahappy.com/</link>
    
    <image>
      <url>https://www.gagahappy.com/icon.png</url>
      <title>睡月花儿</title>
      <link>https://www.gagahappy.com/</link>
    </image>
    
    <atom:link href="https://www.gagahappy.com/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>雅思, 四级, 六级, 英语, 后端, 操作系统, 互联网, 程序开发, Linux, 数据库, MySql, Golang, Ruby</description>
    <pubDate>Tue, 20 May 2025 07:56:20 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>ielts06</title>
      <link>https://www.gagahappy.com/ielts06/</link>
      <guid>https://www.gagahappy.com/ielts06/</guid>
      <pubDate>Tue, 20 May 2025 15:26:15 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;英文故事：-”The-Forgotten-Turret”&quot;&gt;&lt;a href=&quot;#英文故事：-”The-Forgotten-Turret”&quot; class=&quot;headerlink&quot; title=&quot;英文故事：**”The Forgotten</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="英文故事：-”The-Forgotten-Turret”"><a href="#英文故事：-”The-Forgotten-Turret”" class="headerlink" title="英文故事：**”The Forgotten Turret”**"></a>英文故事：**”The Forgotten Turret”**</h1><p>On a remote <strong>continent</strong>, archaeologists set out to <strong>discover</strong> a hidden fortress believed to date back to the 12th century. Its main <strong>turret</strong> had fallen into <strong>dormancy</strong>, hidden beneath layers of earth. The team, led by a brilliant <strong>coordinator</strong>, used <strong>statistics</strong> and satellite data to <strong>calculate</strong> its approximate location.</p><p>The weather was tough—<strong>atmospheric</strong> pressure and <strong>stuffy</strong> air made breathing difficult. Despite this, the <strong>major</strong> discovery drove them on. When they tried to unearth the turret, a worker accidentally <strong>mishandled</strong> a tool and nearly caused a collapse. Luckily, no one was injured, and the event was later deemed <strong>excusable</strong>.</p><p>The coordinator <strong>proposed</strong> to <strong>demolish</strong> some unstable walls to safely access the core. Some historians protested, citing <strong>tradition</strong> and cultural <strong>honour</strong>, but the structure wasn’t <strong>durable</strong> enough to withstand continued <strong>suppression</strong> from the weight of time.</p><p>Among the ruins, they found old scrolls, one of which contained what seemed like an ancient <strong>antidote</strong> recipe. Though not <strong>necessarily</strong> magical, its ingredients were unusual.</p><p>After their return, a museum offered a paid <strong>subscription</strong> for monthly updates about the site. The coordinator received a special <strong>licence</strong> to curate the relics. At the celebration event, one researcher appeared nearly <strong>naked</strong>, a result of a lost bet. It was <strong>mainly</strong> a humorous moment, though he felt slightly <strong>guilty</strong>.</p><p>Finally, a loose stone dislodged during the ceremony—perhaps a sign that history still had secrets to tell, waiting to <strong>dislodge</strong> themselves.</p><h1 id="单词造句表格"><a href="#单词造句表格" class="headerlink" title="单词造句表格"></a>单词造句表格</h1><table><thead><tr><th>序号</th><th>单词</th><th>英文例句</th><th>中文翻译</th></tr></thead><tbody><tr><td>1</td><td>calculate</td><td>Engineers [/ˌendʒɪˈnɪr/] calculate the bridge’s weight limit carefully.</td><td>工程师仔细计算桥的承重极限。</td></tr><tr><td>2</td><td>dormancy</td><td>Seeds can remain in dormancy for months before germinating.</td><td>种子在发芽之前可以保持休眠状态数月之久</td></tr><tr><td>3</td><td>particular</td><td>Is there a particular reason why you’re upset?</td><td>你生气有特别的原因吗？</td></tr><tr><td>4</td><td>subscription</td><td>I bought a subscription to the online magazine.</td><td>我订阅了这本在线杂志。</td></tr><tr><td>5</td><td>demolish</td><td>They plan to demolish the old building next month.</td><td>他们计划下个月拆除那栋老楼。</td></tr><tr><td>6</td><td>durable</td><td>These boots are made of durable leather.</td><td>这双靴子由耐用的皮革制成。</td></tr><tr><td>7</td><td>tradition</td><td>It’s a family tradition to gather at New Year.</td><td>一家人在新年团聚是我们的传统。</td></tr><tr><td>8</td><td>statistics</td><td>Statistics show a rise in employment this year.</td><td>统计数据显示今年就业率上升。</td></tr><tr><td>9</td><td>stuffy</td><td>The classroom was hot and stuffy.</td><td>教室又热又闷。</td></tr><tr><td>10</td><td>approximately</td><td>The flight takes approximately ten hours.</td><td>飞行时间大约为十小时。</td></tr><tr><td>11</td><td>excusable</td><td>His mistake was excusable under the circumstances.</td><td>在这种情况下他的错误可以原谅。</td></tr><tr><td>12</td><td>propose</td><td>He proposed a new solution to the problem.</td><td>他提出了一个新解决方案。</td></tr><tr><td>13</td><td>atmospheric</td><td>The atmospheric pressure dropped suddenly.</td><td>大气压突然下降。</td></tr><tr><td>14</td><td>honour</td><td>The soldier was buried with full honour.</td><td>这名士兵以最高荣誉下葬。</td></tr><tr><td>15</td><td>dislodge</td><td>They tried to dislodge the rock from the road.</td><td>他们试图将那块岩石从路上移开。(v.（把某物）强行去除，取出)</td></tr><tr><td>16</td><td>licence</td><td>She finally got her driving licence.</td><td>她终于拿到了驾照。</td></tr><tr><td>17</td><td>major</td><td>Climate change is a major global issue.</td><td>气候变化是一个主要的全球问题。</td></tr><tr><td>18</td><td>antidote</td><td>The nurse administered an antidote for the poison /ˈpɔɪzn/.</td><td>护士给中毒者注射了解毒剂( administer 给予，施用（药物等）)</td></tr><tr><td>19</td><td>discover</td><td>Scientists hope to discover new planets.</td><td>科学家希望发现新的行星。</td></tr><tr><td>20</td><td>necessarily</td><td>More money doesn’t necessarily [/ˌnesəˈserəli/] mean more happiness.</td><td>更多的钱不一定意味着更多的幸福。(adv.必然地)</td></tr><tr><td>21</td><td>turret</td><td>The castle had four tall turrets [/ˈtɜːrət/] at each corner.</td><td>城堡四角都有高塔楼。</td></tr><tr><td>22</td><td>continent</td><td>Africa is a continent [/ˈkɑːntɪnənt/] rich in natural resources.</td><td>非洲是一个自然资源丰富的大陆。</td></tr><tr><td>23</td><td>mishandle</td><td>The courier mishandled the fragile [/ˈfrædʒ(ə)l/] package.</td><td>快递员处理易碎包裹不当。</td></tr><tr><td>24</td><td>suppression</td><td>The regime relied on suppression to maintain power.</td><td>该政权依靠镇压来维持权力。(镇压，压制)</td></tr><tr><td>25</td><td>mainly</td><td>The course is mainly about data science.</td><td>这门课程主要是关于数据科学的。</td></tr><tr><td>26</td><td>naked</td><td>The statue [/ˈstætʃuː/] depicts a naked warrior.</td><td>这尊雕像描绘了一位裸体战士。</td></tr><tr><td>27</td><td>coordinator</td><td>The event coordinator did an excellent job.</td><td>活动协调人做得非常出色。</td></tr><tr><td>28</td><td>guilty</td><td>He felt guilty for forgetting her birthday.</td><td>他因忘记她的生日而感到内疚。</td></tr></tbody></table><h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p><strong>administer</strong> 和 <strong>inject</strong> 有区别：</p><ul><li><strong>administer an antidote</strong> 更正式，意思是“给予（药物、解毒剂等）”，不仅限于注射，也包括口服、滴注等方式。</li><li><strong>inject an antidote</strong> 专指“用注射的方式给药”。</li></ul><p>如果你确定解毒剂是通过注射给的，用 <strong>inject</strong> 也可以，但如果不确定具体方式，或者想表达更广泛的给药方式，<strong>administer</strong> 更合适。</p><p>所以，句子可以改成：</p><ul><li>The nurse <strong>injected</strong> an antidote to the poisoned person.（强调注射）</li></ul><p>但更常见和正式的是：</p><ul><li>The nurse <strong>administered</strong> an antidote to the poisoned person.</li></ul>]]></content:encoded>
      
      
      <category domain="https://www.gagahappy.com/categories/enlng/">英语</category>
      
      
      <category domain="https://www.gagahappy.com/tags/ielts/">雅思</category>
      
      
      <comments>https://www.gagahappy.com/ielts06/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>mysql or 导致的全表扫描</title>
      <link>https://www.gagahappy.com/mysql-scan-full-by-or/</link>
      <guid>https://www.gagahappy.com/mysql-scan-full-by-or/</guid>
      <pubDate>Tue, 14 Dec 2021 13:56:15 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;or-导致的全表扫描&quot;&gt;&lt;a href=&quot;#or-导致的全表扫描&quot; class=&quot;headerlink&quot; title=&quot;or 导致的全表扫描&quot;&gt;&lt;/a&gt;or 导致的全表扫描&lt;/h1&gt;&lt;pre class=&quot;line-numbers language-sql&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="or-导致的全表扫描"><a href="#or-导致的全表扫描" class="headerlink" title="or 导致的全表扫描"></a>or 导致的全表扫描</h1><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> id <span class="token keyword">from</span> tradelog <span class="token keyword">where</span> tradeid <span class="token operator">=</span> <span class="token string">'12'</span> <span class="token operator">or</span> operator <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------+---------------+------+---------+------+--------+----------+-------------+</span><span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>  <span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span>   <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+---------------+------+---------+------+--------+----------+-------------+</span><span class="token operator">|</span> <span class="token keyword">ALL</span>  <span class="token operator">|</span> tradeid       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token number">389107</span> <span class="token operator">|</span>    <span class="token number">10.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+---------------+------+---------+------+--------+----------+-------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查询条件中有 or 时，mysql 会分别查询每一个条件，然后再把结果合并在一起。</p><p>先对 tradeid = ‘12’ 进行判断，发现可以使用索引，再对 operator = 10 进行判断，发现不能使用索引，只好全表扫描，即然都全表扫描了，顺带也就可以判断当前记录的 tradeid 是否等于 12，就不需要在单独再搜索 tradeid 索引树了。</p><p>所以当 or 条件中出现没有索引的字段会导致使用全表扫描。如果出现的字段都有索引，mysql会尽量使用每个列的索引</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> id <span class="token keyword">from</span> tradelog <span class="token keyword">where</span> tradeid <span class="token operator">=</span> <span class="token string">'12'</span> <span class="token operator">or</span> id <span class="token operator">=</span><span class="token number">10</span>  <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------------+----------+-------------+-----------------+-----------------+</span><span class="token operator">|</span> id <span class="token operator">|</span> select_type <span class="token operator">|</span> <span class="token keyword">table</span>    <span class="token operator">|</span> <span class="token keyword">type</span>        <span class="token operator">|</span> possible_keys   <span class="token operator">|</span> <span class="token keyword">key</span>             <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+----------+-------------+-----------------+-----------------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> <span class="token keyword">SIMPLE</span>      <span class="token operator">|</span> tradelog <span class="token operator">|</span> index_merge <span class="token operator">|</span> <span class="token keyword">PRIMARY</span><span class="token punctuation">,</span>tradeid <span class="token operator">|</span> tradeid<span class="token punctuation">,</span><span class="token keyword">PRIMARY</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------------+----------+-------------+-----------------+-----------------+</span><span class="token operator">+</span><span class="token comment">---------+------+------+----------+-------------------------------------------+</span><span class="token operator">|</span> key_len <span class="token operator">|</span> ref  <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra                                     <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+------+------+----------+-------------------------------------------+</span><span class="token operator">|</span> <span class="token number">131</span><span class="token punctuation">,</span><span class="token number">4</span>   <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>   <span class="token number">100.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">union</span><span class="token punctuation">(</span>tradeid<span class="token punctuation">,</span><span class="token keyword">PRIMARY</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">---------+------+------+----------+-------------------------------------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>虽然条件中也有 or ，但 tradeid 和 id 都有索引，mysql 分别单独对这两个索引扫描，然后把找到的结果再合并到一起。执行计划显示 <code>type:index_merge</code> ， <code>key:tradeid,PRIMARY</code>，<code>Extra:Using union</code></p><p>同样的条件，把 or 换成 and 时是可以走索引的，因为找的是要满足所有条件的记录，那么就可以在最小的索引树先找到一条满足条件的记录，再检查这条记录是否还满足其它条件</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">explain</span> <span class="token keyword">select</span> id <span class="token keyword">from</span> tradelog <span class="token keyword">where</span> tradeid <span class="token operator">=</span> <span class="token string">'12'</span> <span class="token operator">and</span>  operator <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------+---------------+---------+---------+-------+------+----------+-------------+</span><span class="token operator">|</span> <span class="token keyword">type</span> <span class="token operator">|</span> possible_keys <span class="token operator">|</span> <span class="token keyword">key</span>     <span class="token operator">|</span> key_len <span class="token operator">|</span> ref   <span class="token operator">|</span> <span class="token keyword">rows</span> <span class="token operator">|</span> filtered <span class="token operator">|</span> Extra       <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+---------------+---------+---------+-------+------+----------+-------------+</span><span class="token operator">|</span> ref  <span class="token operator">|</span> tradeid       <span class="token operator">|</span> tradeid <span class="token operator">|</span> <span class="token number">131</span>     <span class="token operator">|</span> const <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">10.00</span> <span class="token operator">|</span> <span class="token keyword">Using</span> <span class="token keyword">where</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------+---------------+---------+---------+-------+------+----------+-------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>key:tradeid  显示使用了 tradeid 索引。通过索引树先找到一条  tradeid = ‘12’的记录，再回表查询 operator 是否等于 10。</p>]]></content:encoded>
      
      
      <category domain="https://www.gagahappy.com/categories/database/">数据库</category>
      
      
      <category domain="https://www.gagahappy.com/tags/mysql/">mysql</category>
      
      
      <comments>https://www.gagahappy.com/mysql-scan-full-by-or/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>mysql 如何为字符串合理创建索引</title>
      <link>https://www.gagahappy.com/mysql-how-add-index-for-string/</link>
      <guid>https://www.gagahappy.com/mysql-how-add-index-for-string/</guid>
      <pubDate>Sat, 20 Nov 2021 19:21:16 GMT</pubDate>
      
        
        
          
          
      <description>&lt;p&gt;对于一般长度的字符串，用整个字符串直接作为索引即可，但对于比较长的字符串，比如email，身份证号如果直接作为索引，会占用较大的磁盘空间&lt;/p&gt;
&lt;h1 id=&quot;前缀索引&quot;&gt;&lt;a href=&quot;#前缀索引&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<p>对于一般长度的字符串，用整个字符串直接作为索引即可，但对于比较长的字符串，比如email，身份证号如果直接作为索引，会占用较大的磁盘空间</p><h1 id="前缀索引"><a href="#前缀索引" class="headerlink" title="前缀索引"></a>前缀索引</h1><p>可以为较长的字符串设置前缀索引，缩短索引字段的长度，减少占用磁盘的空间</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> users <span class="token keyword">add</span> <span class="token keyword">index</span> index1<span class="token punctuation">(</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">alter</span> <span class="token keyword">table</span> users <span class="token keyword">add</span> <span class="token keyword">index</span> index2<span class="token punctuation">(</span>email<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>索引 index1 包含了整个字符串，而 index2 只包含了前6个字符串，比 index1 占用更少的空间。那么如何定义前缀长度呢？如果太短，索引的区分度就会不高，增加额外的扫描次数，查询效率下降，太长又不能节省空间。可以用下面的方法进行判断，选择最接近1的，同时长度最短的来作为前缀。</p><h2 id="前缀索引的长度"><a href="#前缀索引的长度" class="headerlink" title="前缀索引的长度"></a>前缀索引的长度</h2><p>首先计算出这个列上有多少个不同的值(计为total)</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> email<span class="token punctuation">)</span> <span class="token keyword">as</span> total <span class="token keyword">from</span> users<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后取不同长度的前缀，计算有多少个不同的值，分别除以 total，选择最接近1的且前缀较短的</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span>   <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>）<span class="token operator">/</span> total <span class="token keyword">as</span> L4<span class="token punctuation">,</span>  <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>）<span class="token operator">/</span> total <span class="token keyword">as</span> L5<span class="token punctuation">,</span>  <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>）<span class="token operator">/</span> total <span class="token keyword">as</span> L6<span class="token punctuation">,</span>  <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> <span class="token keyword">left</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span>）<span class="token operator">/</span> total <span class="token keyword">as</span> L7<span class="token punctuation">,</span><span class="token keyword">from</span> users<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>假设结果为： L4 40%，L5  90%， L6 96% ，L7 96%。而你只接受大于95%的区分度，L6/L7等符合，那么选择前缀为6的最为适合。</p><h2 id="增加扫描次数"><a href="#增加扫描次数" class="headerlink" title="增加扫描次数"></a>增加扫描次数</h2><p>假设users表有如下记录，分别建立索引 index1(email)，index2(email,5)</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">id<span class="token punctuation">,</span>  email<span class="token punctuation">,</span>              <span class="token punctuation">,</span>username<span class="token punctuation">,</span> addersid1<span class="token punctuation">,</span> xiaoming123<span class="token variable">@xyz.com</span> <span class="token punctuation">,</span>省略id2<span class="token punctuation">,</span> xiaoming456<span class="token variable">@xyz.com</span> <span class="token punctuation">,</span>省略id3<span class="token punctuation">,</span> xiaoming789<span class="token variable">@xyz.com</span> <span class="token punctuation">,</span>省略id4<span class="token punctuation">,</span> xiaomingABC<span class="token variable">@xyz.com</span> <span class="token punctuation">,</span>省略id5<span class="token punctuation">,</span> zhanghao123<span class="token variable">@xyz.com</span>    <span class="token punctuation">,</span>省略id6<span class="token punctuation">,</span> zhanghao456<span class="token variable">@xyz.com</span>    <span class="token punctuation">,</span>省略<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>索引 index1的页节点数据</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">(</span>xiaoming123<span class="token variable">@xyz.com</span><span class="token punctuation">,</span>id1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>xiaoming456<span class="token variable">@xyz.com</span><span class="token punctuation">,</span>id2<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>xiaoming789<span class="token variable">@xyz.com</span><span class="token punctuation">,</span>id3<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>xiaomingABC<span class="token variable">@xyz.com</span><span class="token punctuation">,</span>id4<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>zhang123<span class="token variable">@xyz.com</span><span class="token punctuation">,</span>id5<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>zhang456<span class="token variable">@xyz.com</span><span class="token punctuation">,</span>id6<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>索引 index2的页节点数据</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token punctuation">(</span>xiaom<span class="token punctuation">,</span>id1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>xiaom<span class="token punctuation">,</span>id2<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>xiaom<span class="token punctuation">,</span>id3<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>xiaom<span class="token punctuation">,</span>id4<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>zhang<span class="token punctuation">,</span>id5<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>zhang<span class="token punctuation">,</span>id6<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以看到，前缀索引占用更少的数据空间</p><p>索引查询过程</p><p>现查询email为<code>xiaoming456@xyz.com&#39;</code>的用户信息</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> email<span class="token operator">=</span><span class="token string">'xiaoming456@xyz.com'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>index1索引查询过程</p><ol><li>搜索index1索引树，找到等于 <code>xiaoming456@xyz.com</code> 的记录，取出主键的值 <code>id2</code></li><li>根据主键值 id2 回表查询，把记录放入返回结果集中</li><li>再接着向右移动，发现记录不符，返回，查询结束，把结果集返回客户端</li></ol><p>index2索引查询过程</p><ol><li>搜索index2索引树，找到等于 <code>xiaom</code> 的记录(取前5位进行查询)，取出主键的值 <code>id1</code></li><li>根据主键值 id1 回表查询，发现email值不等于<code>xiaoming456@xyz.com</code></li><li>再接着向右移动，发现等于<code>xiaom</code>，取出主键的值 <code>id2</code></li><li>根据主键值 id2  回表查询，发现email值等于<code>xiaoming456@xyz.com</code>，放入返回结果集</li><li>重复以上过程，直到遇到<code>zhang</code>时，查询结束</li></ol><p>使用前缀索引 index2 一共需要查找4次，增加了扫描的次数。但如果把前缀索引设置为email(9)，也只需要查找一次，因为等于<code>xiaoming4</code>只有一条，找到后查询也结束了。</p><p>通过选择适当的前缀索引的长度，即节省空间，查询成本也不会太高</p><h2 id="覆盖索引无效"><a href="#覆盖索引无效" class="headerlink" title="覆盖索引无效"></a>覆盖索引无效</h2><p>同样是查询<code>select id, email from users where email=&#39;xiaoming456@xyz.com&#39;;</code></p><ul><li>如果在 email 上建立普通索引，在找到记录后，由于索引包含了id的值，不用回表，直接返回结果即可</li><li>如果在 email 上建立前缀索引，在找到记录后，由于索引信息不完整，即使包含了id的值，也需要回表查询是否与email的完整值相匹配</li></ul><p>这样就导致了在前缀索引上，无法使用覆盖索引对查询性能的优化</p><h1 id="Hash字段"><a href="#Hash字段" class="headerlink" title="Hash字段"></a>Hash字段</h1><p>比如对身份证进行查询，其长度为18位，直接建立索引会占用较多的空间，如果使用前缀索引只取前几位但相同的概率很大，取太长又不能节省空间，此时可以添加一个字段，用来存放身份证的 hash 值，并为这个hash字段建立索引</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">alter</span> <span class="token keyword">table</span> t <span class="token keyword">add</span> idcard_hash <span class="token keyword">int</span> <span class="token keyword">unsigned</span><span class="token punctuation">,</span> <span class="token keyword">add</span> <span class="token keyword">index</span><span class="token punctuation">(</span>idcard_hash<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>索引的长度变成了 4 个字节，就算算上hash字段本身占用的空间，也要比原来小了很多。由于hash值存在冲突，在查询时还要加上身份证字段，确保精确匹配以取到正确的记录，这样就可以即节省空间，又高效的查询了</p> <pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> idcard_hash<span class="token operator">=</span>hash_algorithm<span class="token punctuation">(</span><span class="token string">'input_id_card_string'</span><span class="token punctuation">)</span> <span class="token operator">and</span> id_card<span class="token operator">=</span><span class="token string">'input_id_card_string'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>hash字段的缺点</p><ul><li>不能进行范围查询</li><li>使用hash函数会消耗CPU</li></ul><p>这里其实还有一个思路，把身份证倒序存储，这样就不用额外再建立字段，同时可以使用前缀索引，但至少要用前8位来建立前缀索引，即8字节，其占用空间和使用hash字段就差不多了，因为是前缀索引，必定要回表查询，增加了扫描次数，查询性能也有没hash字段稳定，况且8位应该是不够的，占用空间肯定要比使用hash字段要大。</p><h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><ol><li>直接创建完整索引，这样可能比较占用空间</li><li>创建前缀索引，节省空间，但会增加查询扫描次数，并且不能使用覆盖索引</li><li>倒序存储，再创建前缀索引，用于绕过字符串本身前缀的区分度不够的问题</li><li>创建 hash 字段索引，查询性能稳定，有额外的存储和计算消耗，跟第三种方式一样，都不支持范围扫描</li></ol>]]></content:encoded>
      
      
      <category domain="https://www.gagahappy.com/categories/database/">数据库</category>
      
      
      <category domain="https://www.gagahappy.com/tags/mysql/">mysql</category>
      
      
      <comments>https://www.gagahappy.com/mysql-how-add-index-for-string/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>mysql 自增值规则</title>
      <link>https://www.gagahappy.com/mysql-auto-increment/</link>
      <guid>https://www.gagahappy.com/mysql-auto-increment/</guid>
      <pubDate>Mon, 15 Nov 2021 15:28:20 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;Auto-increment&quot;&gt;&lt;a href=&quot;#Auto-increment&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="Auto-increment"><a href="#Auto-increment" class="headerlink" title="Auto_increment"></a>Auto_increment</h1><p>表结构如下，且假设当前系统中只有一个连接</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t<span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token keyword">int</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>a<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>a<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token keyword">KEY</span> <span class="token punctuation">`</span>b<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>b<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>建表时把主键id设置为<code>id int(11) NOT NULL AUTO_INCREMEN</code>，在插入数据时，如果不指定id，系统会为id自动设置值 ，并把Auto_increment的值，作为下一条记录id的值</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> t<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+------+------+</span><span class="token operator">|</span> id     <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+------+------+</span><span class="token operator">|</span> <span class="token number">200001</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+------+------+</span><span class="token keyword">show</span> <span class="token keyword">table</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'t'</span>\G<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>   Index_length: <span class="token number">32768</span>      Data_free: <span class="token number">10485760</span> <span class="token keyword">Auto_increment</span>: <span class="token number">200002</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再插入时如果没有指定id，则使用200002作为其值，Auto_increment的值更新为200003</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> t<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+------+------+</span><span class="token operator">|</span> id     <span class="token operator">|</span> a    <span class="token operator">|</span> b    <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+------+------+</span><span class="token operator">|</span> <span class="token number">200001</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">200002</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+------+------+</span><span class="token keyword">show</span> <span class="token keyword">table</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'t'</span>\G<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>   Index_length: <span class="token number">32768</span>      Data_free: <span class="token number">10485760</span> <span class="token keyword">Auto_increment</span>: <span class="token number">200003</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果把id=200001记录删除，然后指定id的值为200001，插入这样一条记录，那么Auto_increment的值不增长，依然为200003。同时可以看到，由于默认是主键索引排序，即使id=200001被删除后，再次插入，也排在了200002的前面</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">delete</span> <span class="token keyword">from</span> t <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">200001</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t<span class="token punctuation">(</span>id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">200001</span><span class="token punctuation">,</span><span class="token number">200001</span><span class="token punctuation">,</span><span class="token number">200001</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+--------+--------+</span><span class="token operator">|</span> id     <span class="token operator">|</span> a      <span class="token operator">|</span> b      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+--------+--------+</span><span class="token operator">|</span> <span class="token number">200001</span> <span class="token operator">|</span> <span class="token number">200001</span> <span class="token operator">|</span> <span class="token number">200001</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">200002</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+--------+--------+</span><span class="token keyword">show</span> <span class="token keyword">table</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'t'</span>\G<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>   Index_length: <span class="token number">32768</span>      Data_free: <span class="token number">10485760</span> <span class="token keyword">Auto_increment</span>: <span class="token number">200003</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再插入一条记录也可以验证，新记录的id值为200003。</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> t<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+--------+--------+</span><span class="token operator">|</span> id     <span class="token operator">|</span> a      <span class="token operator">|</span> b      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+--------+--------+</span><span class="token operator">|</span> <span class="token number">200001</span> <span class="token operator">|</span> <span class="token number">200001</span> <span class="token operator">|</span> <span class="token number">200001</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">200002</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">200003</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+--------+--------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还可以手动插入一个不连续的id:200006</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> t<span class="token punctuation">(</span>id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">200006</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此时 Auto_increment的值为 200007，如果插入id比它小的值，则 Auto_incrementr的值不增长，依然为 200007</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> t<span class="token punctuation">(</span>id<span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">200005</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------+--------+--------+</span><span class="token operator">|</span> id     <span class="token operator">|</span> a      <span class="token operator">|</span> b      <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+--------+--------+</span><span class="token operator">|</span> <span class="token number">200001</span> <span class="token operator">|</span> <span class="token number">200001</span> <span class="token operator">|</span> <span class="token number">200001</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">200002</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">200003</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">200005</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">200006</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------+--------+--------+</span><span class="token keyword">show</span> <span class="token keyword">table</span> <span class="token keyword">status</span> <span class="token operator">like</span> <span class="token string">'t'</span>\G<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span> <span class="token number">1.</span> <span class="token keyword">row</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>   Index_length: <span class="token number">32768</span>      Data_free: <span class="token number">10485760</span> <span class="token keyword">Auto_increment</span>: <span class="token number">200007</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在以上操作中，如果通过<code>show table status like</code>查看<code>Auto_increment</code>的值没有变化，运行<code>analyze table t</code>手动更新表的统计信息后再查看</p>]]></content:encoded>
      
      
      <category domain="https://www.gagahappy.com/categories/database/">数据库</category>
      
      
      <category domain="https://www.gagahappy.com/tags/mysql/">mysql</category>
      
      
      <comments>https://www.gagahappy.com/mysql-auto-increment/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>mysql limit 的妙用</title>
      <link>https://www.gagahappy.com/mysql-update-with-limit/</link>
      <guid>https://www.gagahappy.com/mysql-update-with-limit/</guid>
      <pubDate>Sat, 04 Sep 2021 13:15:32 GMT</pubDate>
      
        
        
          
          
      <description>&lt;p&gt;更新无索引的列，会导致全表被锁，其它线程无法更新表中的数据，如果加入了&lt;code&gt;limit N&lt;/code&gt;关键字，可以减少被锁定的行，在一定程度上可以提高并发&lt;/p&gt;
&lt;p&gt;表结构及数据如下&lt;/p&gt;
&lt;pre class=&quot;line-numbers</description>
          
        
      
      
      
      <content:encoded><![CDATA[<p>更新无索引的列，会导致全表被锁，其它线程无法更新表中的数据，如果加入了<code>limit N</code>关键字，可以减少被锁定的行，在一定程度上可以提高并发</p><p>表结构及数据如下</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>t<span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">null</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>age<span class="token punctuation">`</span> <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token boolean">null</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>ismale<span class="token punctuation">`</span> <span class="token keyword">tinyint</span> <span class="token keyword">default</span> <span class="token boolean">null</span><span class="token punctuation">)</span> <span class="token keyword">engine</span><span class="token operator">=</span><span class="token keyword">innodb</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'d001'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'d003'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'d005'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">'d007'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">'d009'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token string">'d011'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+------+------+--------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name <span class="token operator">|</span> age  <span class="token operator">|</span> ismale <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+------+--------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> d001 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> d003 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> d005 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> d007 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> d009 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> d011 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+------+--------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="不加入limit锁全表"><a href="#不加入limit锁全表" class="headerlink" title="不加入limit锁全表"></a>不加入<code>limit</code>锁全表</h2><table><thead><tr><th>时刻</th><th>Session A</th><th>Session B</th></tr></thead><tbody><tr><td>T1</td><td>begin;</td><td></td></tr><tr><td></td><td>update t set age=31 where name=’d003’;</td><td></td></tr><tr><td>T2</td><td></td><td>Begin;</td></tr><tr><td></td><td></td><td>update t set age=31 where name=’d005’;<font color=red>(blocked)</font></td></tr><tr><td></td><td></td><td>update t set age=31 where id=5;<font color=red>(blocked)</font></td></tr><tr><td></td><td></td><td>insert into t values(2,’d002’,30,1);<font color=red>(blocked)</font></td></tr><tr><td></td><td></td><td>insert into t values(12,’d012’,30,1);<font color=red>(blocked)</font></td></tr></tbody></table><h3 id="SessionA的加锁范围"><a href="#SessionA的加锁范围" class="headerlink" title="SessionA的加锁范围"></a>SessionA的加锁范围</h3><p>主键索引<code>id</code>锁的范围是[infimum，supremum]</p><p>由于name列没有索引，<code>where name=&#39;d003&#39;</code>查询时走主键索引，全表扫描。先找到id=1的行，加<code>next-key</code>锁，发现name的值不匹配，继续向右查找，给id=3的行上锁，name匹配，返回结果给server层，然后继续向右查找直到最后一行id=11，查找过程中涉及到的行都被加了<code>next-key</code>锁(id=5,7,9,11的行)，由于事务没有提交，这些行锁没有被释放。</p><h3 id="SessionB被阻塞在哪里"><a href="#SessionB被阻塞在哪里" class="headerlink" title="SessionB被阻塞在哪里"></a>SessionB被阻塞在哪里</h3><p>更新条件 <code>where name=&#39;d005&#39;</code>，由于name列没有索引，查询时也要走主键索引。先找到id=1的行，加<code>next-key</code>锁，由于SessionA已经加了<code>next-key</code>锁，SessionB只能等待，它在此时发生了阻塞</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> t <span class="token keyword">set</span> age<span class="token operator">=</span><span class="token number">31</span> <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'d005'</span><span class="token comment"># 被SessionA上的 id=1的行的 next-key锁阻塞</span>RECORD LOCKS space id <span class="token number">5</span> page <span class="token keyword">no</span> <span class="token number">4</span> n bits <span class="token number">80</span> <span class="token keyword">index</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">of</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>t<span class="token punctuation">`</span>trx id <span class="token number">4366</span> lock_mode X waiting <span class="token number">0</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">80000001</span><span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">1</span>: len <span class="token number">6</span><span class="token punctuation">;</span> hex <span class="token number">000000000</span>d98<span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">2</span>: len <span class="token number">7</span><span class="token punctuation">;</span> hex <span class="token number">81000000</span>a70110<span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">3</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">64303031</span><span class="token punctuation">;</span> <span class="token keyword">asc</span> d001 <span class="token number">4</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">8000001</span>e<span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">5</span>: len <span class="token number">1</span><span class="token punctuation">;</span> hex <span class="token number">81</span><span class="token punctuation">;</span> <span class="token keyword">asc</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过Id=5更新也会被SessinA的<code>next-key</code>锁阻塞，虽然SessionB加要的是<code>行锁</code>，这也从则面说明了<code>next-key</code>是由<code>行锁</code>和<code>间隙锁</code>组成</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> t <span class="token keyword">set</span> age<span class="token operator">=</span><span class="token number">31</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">5</span><span class="token comment"># 被id=5的记录上行锁阻塞</span>RECORD LOCKS space id <span class="token number">5</span> page <span class="token keyword">no</span> <span class="token number">4</span> n bits <span class="token number">80</span> <span class="token keyword">index</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">of</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>t<span class="token punctuation">`</span>trx id <span class="token number">4367</span> lock_mode X locks rec but <span class="token operator">not</span> gap waiting <span class="token number">0</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">80000005</span><span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">1</span>: len <span class="token number">6</span><span class="token punctuation">;</span> hex <span class="token number">000000000</span>d9e<span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">2</span>: len <span class="token number">7</span><span class="token punctuation">;</span> hex <span class="token number">82000000</span>a80110<span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">3</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">64303034</span><span class="token punctuation">;</span> <span class="token keyword">asc</span> d004 <span class="token number">4</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">8000001</span>e<span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">5</span>: len <span class="token number">1</span><span class="token punctuation">;</span> hex <span class="token number">81</span><span class="token punctuation">;</span> <span class="token keyword">asc</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>插入数据也被阻塞，因为插入Id的值都落在了<code>间隙锁</code>[infimum，supremum]内，无法插入任何的值。</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'d002'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment"># 插入id=2的值，被间隙锁(1,3)阻塞</span>RECORD LOCKS space id <span class="token number">5</span> page <span class="token keyword">no</span> <span class="token number">4</span> n bits <span class="token number">80</span> <span class="token keyword">index</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">of</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>t<span class="token punctuation">`</span>trx id <span class="token number">4365</span> lock_mode X locks gap before rec <span class="token keyword">insert</span> intention waiting <span class="token number">0</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">80000003</span><span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">1</span>: len <span class="token number">6</span><span class="token punctuation">;</span> hex <span class="token number">000000001106</span><span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">2</span>: len <span class="token number">7</span><span class="token punctuation">;</span> hex <span class="token number">01000001120488</span><span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">3</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">64303033</span><span class="token punctuation">;</span> <span class="token keyword">asc</span> d003 <span class="token number">4</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">8000001</span>f<span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">5</span>: len <span class="token number">1</span><span class="token punctuation">;</span> hex <span class="token number">81</span><span class="token punctuation">;</span> <span class="token keyword">asc</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="加入limit减少被锁的行"><a href="#加入limit减少被锁的行" class="headerlink" title="加入limit减少被锁的行"></a>加入<code>limit</code>减少被锁的行</h2><table><thead><tr><th>时刻</th><th>Session A</th><th>Session B</th></tr></thead><tbody><tr><td>T1</td><td>begin;</td><td></td></tr><tr><td>T2</td><td>update t set age=31 where name=’d003’ limit 1;</td><td></td></tr><tr><td>T3</td><td></td><td>begin;</td></tr><tr><td>T4</td><td></td><td>update t set age=31 where name=’d005’;<font color=red>(blocked)</font></td></tr><tr><td></td><td></td><td>insert into t values(2,’d002’,30,1);<font color=red>(blocked)</font></td></tr><tr><td>T5</td><td></td><td>insert into t values(4,’d004’,30,1);<font color=green>(Query Ok)</font></td></tr></tbody></table><h3 id="SessionA加锁的范围是怎么样的"><a href="#SessionA加锁的范围是怎么样的" class="headerlink" title="SessionA加锁的范围是怎么样的"></a>SessionA加锁的范围是怎么样的</h3><p>主键索引<code>id</code>锁的范围是[infimum，3]</p><p>由于name列没有索引，查询时走主键索引，全表扫描。先找到id=1的行，加<code>next-key</code>锁，发现name的值不匹配，继续向右查找，给id=3的行上锁，name匹配，返回结果给server层，由于使用了<code>limit 1</code>，满足条件，不再向后查找，查询结束。记录(id:1),(id:3)的行上了<code>next-key</code>锁，之后的记录没有上锁。</p><h3 id="SessionB被阻塞在哪里-1"><a href="#SessionB被阻塞在哪里-1" class="headerlink" title="SessionB被阻塞在哪里"></a>SessionB被阻塞在哪里</h3><p>更新条件 <code>where name=&#39;d005&#39;</code>，由于name列没有索引，查询时也要走主键索引。先找到id=1的行，加<code>next-key</code>锁，由于SessionA已经加了<code>next-key</code>锁，SessionB只能等待，它在此时发生了阻塞</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> t <span class="token keyword">set</span> age<span class="token operator">=</span><span class="token number">31</span> <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'d005'</span><span class="token comment"># 被SessionA上的 id=1的行的 next-key锁阻塞</span>RECORD LOCKS space id <span class="token number">5</span> page <span class="token keyword">no</span> <span class="token number">4</span> n bits <span class="token number">80</span> <span class="token keyword">index</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">of</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>t<span class="token punctuation">`</span> trx id <span class="token number">4871</span> lock_mode X waiting <span class="token number">0</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">80000001</span><span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">1</span>: len <span class="token number">6</span><span class="token punctuation">;</span> hex <span class="token number">000000000</span>d98<span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">2</span>: len <span class="token number">7</span><span class="token punctuation">;</span> hex <span class="token number">81000000</span>a70110<span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">3</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">64303031</span><span class="token punctuation">;</span> <span class="token keyword">asc</span> d001 <span class="token number">4</span>: len <span class="token number">4</span><span class="token punctuation">;</span> hex <span class="token number">8000001</span>e<span class="token punctuation">;</span> <span class="token keyword">asc</span> <span class="token number">5</span>: len <span class="token number">1</span><span class="token punctuation">;</span> hex <span class="token number">81</span><span class="token punctuation">;</span> <span class="token keyword">asc</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为<code>id</code>锁的范围是[infimum，3]，(id=5,7,9,11)的行没有被上锁，可以更新及插入id &gt; 3的数据。</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># Session B</span><span class="token keyword">insert</span> <span class="token keyword">into</span> t <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'d004'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span>Query Ok<span class="token punctuation">)</span><span class="token comment"># 虽然不能通过 where name='d005' 修改</span><span class="token comment"># 但可以通过where id=5 修改，也说明了id=5的行没有被锁</span><span class="token comment"># 同时也绕过了需要等待id=1的锁的限制</span><span class="token keyword">update</span> t <span class="token keyword">set</span> age<span class="token operator">=</span><span class="token number">31</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token punctuation">(</span>Query Ok<span class="token punctuation">)</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> t<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+------+------+--------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name <span class="token operator">|</span> age  <span class="token operator">|</span> ismale <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+------+--------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> d001 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> d003 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> d004 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> d005 <span class="token operator">|</span>   <span class="token number">31</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> d007 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> d009 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> d011 <span class="token operator">|</span>   <span class="token number">30</span> <span class="token operator">|</span>      <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------+------+--------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content:encoded>
      
      
      <category domain="https://www.gagahappy.com/categories/database/">数据库</category>
      
      
      <category domain="https://www.gagahappy.com/tags/mysql/">mysql</category>
      
      
      <comments>https://www.gagahappy.com/mysql-update-with-limit/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
